
# Shows targets
list:
  just -l

# docker compose UP, logging to log/
dev:
  docker compose up 2>&1 | tee -a log/docker-compose-up.log
up: dev

app-initialize:
  echo run this AFTER up..
  just db-create db-migrate db-seed assets-precompile

# runs "rails console" - requires WEB to be up
console:
  docker compose exec web rails console

db-create:
  docker compose exec web rails db:create

# migrates the WEB app.
db-migrate:
  docker compose exec web rails db:migrate

# seeds the WEB app with sample data
db-seed:
  docker compose exec web rails db:seed

assets-precompile:
  docker compose exec web rails assets:precompile

test:
  docker compose exec web rails test

lint:
  docker compose exec web bundle exec rubocop

build:
  docker compose build

gemini-feedbackloop-build:
  timeout 60 docker compose build

force-rebuild:
  echo 'Note: this command can take up to 30 plus minutes.'
  date | tee -a log/docker-compose-build-nocache.log
  time docker compose build --no-cache 2>&1 | tee -a log/docker-compose-build-nocache.log

down:
  docker compose down

down-and-destroy:
  docker compose down -v

# Shows docker compose logs
logs:
  docker compose logs

# Shows the location of the database volume on your local machine
show-db-volume:
  docker volume inspect docker-awesome-compose_db_data

# Restarts the web service
restart-web:
  docker compose restart web

# Stops the redis service
stop-redis:
  docker compose stop redis

# Starts the redis service
start-redis:
  docker compose start redis

# Shows redis info
redis-info:
  docker compose exec web rails runner "puts Rails.cache.redis.info"

cache-view:
  # @echo First article views:
  docker-compose exec web rails runner 'puts Rails.cache.read("post_1_views")'
  # @echo Second article views:
  docker-compose exec web rails runner 'puts Rails.cache.read("post_2_views")'
